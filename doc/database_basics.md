## データベースの基礎

### はじめに

Webアプリケーションは、ユーザーの情報や投稿内容など、様々なデータを扱います。これらのデータを永続的に（アプリケーションを閉じても消えないように）保存し、必要に応じて取り出したり更新したりする場所が「データベース」です。Railsアプリケーションは、このデータベースと密接に連携して動作します。

---

### 1. データベースとは？

データベースは、整理された形式でデータを保存し、管理するためのシステムです。多くのWebアプリケーションで使われているのは「リレーショナルデータベース（RDB）」と呼ばれる種類です。

*   **リレーショナルデータベース (RDB):** データを「テーブル」という形式で管理します。テーブル同士を関連付ける（リレーション）ことができるのが特徴です。
*   **今回のTODOアプリ:** SQLiteという軽量なRDBを使っています。これはファイルとしてデータを保存するため、手軽に利用できます。

---

### 2. 主要な構成要素

リレーショナルデータベースは、主に以下の要素で構成されます。

*   **テーブル (Table):** データを保存する基本的な単位です。Excelのシートのようなものをイメージすると分かりやすいでしょう。今回のTODOアプリでは、`tasks`というテーブルがあります。

*   **カラム (Column):** テーブルの各項目（属性）です。Excelの列の見出しに当たります。各カラムには、保存するデータの種類（データ型、例: 文字列、数値、真偽値など）が定義されています。
    *   **TODOアプリの`tasks`テーブルの例:**
        *   `id` (整数): 各レコードを一意に識別するための番号（自動で振られます）
        *   `title` (文字列): タスクのタイトル
        *   `completed` (真偽値): タスクが完了したかどうか
        *   `created_at` (日時): レコードが作成された日時（自動で記録されます）
        *   `updated_at` (日時): レコードが最後に更新された日時（自動で記録されます）

*   **レコード (Record / Row):** テーブルの各行です。データの実体であり、一つのレコードが一つのタスク情報に対応します。

*   **主キー (Primary Key):** 各レコードを一意に識別するための特別なカラムです。通常は`id`カラムが主キーとして使われます。主キーは重複せず、必ず値が存在する必要があります。

*   **外部キー (Foreign Key):** 他のテーブルの主キーを参照するカラムです。これにより、異なるテーブル間の関連付け（リレーション）を定義できます。例えば、ユーザーテーブルとタスクテーブルがある場合、タスクテーブルに`user_id`（ユーザーテーブルの`id`を参照）という外部キーを持つことで、「どのユーザーがどのタスクを作成したか」という関連を表現できます。

---

### 3. SQLとは？

SQL（Structured Query Language）は、データベースを操作するための標準的な言語です。データベースからデータを取得したり、新しいデータを追加したり、既存のデータを更新・削除したりする際に使われます。

*   **基本的なSQLコマンドの例:**
    *   `SELECT * FROM tasks;` (タスクテーブルのすべてのデータを取得)
    *   `INSERT INTO tasks (title, completed) VALUES ('牛乳を買う', false);` (新しいタスクを追加)
    *   `UPDATE tasks SET completed = true WHERE id = 1;` (IDが1のタスクを完了済みに更新)
    *   `DELETE FROM tasks WHERE id = 2;` (IDが2のタスクを削除)

Railsでは、通常、直接SQLを書くことはあまりありません。代わりに「Active Record」という仕組みを使って、Rubyのコードでデータベースを操作します。

---

### 4. Railsとデータベース

Railsは、データベースとの連携を非常に簡単にするための強力なツールを提供しています。

*   **Active Record:**
    *   RailsのModelの基盤となる機能で、Rubyのオブジェクト（例: `Task`オブジェクト）としてデータベースのテーブル（例: `tasks`テーブル）を操作できるようにします。
    *   開発者はSQLを意識することなく、Rubyのコードでデータを扱えます。Active Recordが裏側で適切なSQLを自動的に生成し、実行してくれます。
    *   **例:**
        *   `Task.all` (すべてのタスクを取得) → `SELECT * FROM tasks;`
        *   `Task.create(title: '掃除をする', completed: false)` (新しいタスクを作成) → `INSERT INTO tasks ...`

*   **マイグレーション (Migration):**
    *   データベースのスキーマ（構造）の変更履歴を管理するための仕組みです。
    *   `db/migrate`ディレクトリにRubyのコードで記述されたマイグレーションファイルを作成し、`rails db:migrate`コマンドを実行することで、データベースの構造を変更できます。
    *   これにより、データベースの変更をバージョン管理システム（Gitなど）で管理でき、チーム開発や環境構築が容易になります。

*   **シードデータ (Seed Data):**
    *   アプリケーションの初期データやテストデータをデータベースに投入するための仕組みです。
    *   `db/seeds.rb`ファイルにデータを記述し、`rails db:seed`コマンドを実行することで、簡単にデータを投入できます。

---

### 5. 今回のTODOアプリでのデータベース

このTODOアプリでは、以下のデータベース関連のファイルと概念が使われています。

*   **`tasks`テーブル:** タスク情報を保存するためのテーブルです。
*   **`app/models/task.rb`:** `tasks`テーブルに対応するモデルです。Active Recordの機能を使ってデータベースと連携します。
*   **`db/migrate/20250817020452_create_tasks.rb`:** `tasks`テーブルを作成するためのマイグレーションファイルです。
*   **`rails db:migrate`:** このコマンドを実行することで、`tasks`テーブルがデータベースに作成されました。

---

このドキュメントが、データベースの基本的な理解の一助となれば幸いです。
